# Debug level: 2 for now; drop to 1 once stable
log_level: 2

# Options: sequential | vocab_tree_matcher | exhaustive
matching_method: sequential

colmap:
  camera_model: "SIMPLE_RADIAL"
  single_camera: false
  use_gpu: true
  gpu_index: 0

sift:
  extraction_use_gpu: true
  matching_use_gpu: true

  # Aerial: keep rich features
  max_num_features: 8192
  peak_threshold: 0.006
  edge_threshold: 10

  # Optional: if your frames are 4K+ and slow, set e.g. 4000 or 3200
  # max_image_size: 3200

sift_matching:
  max_ratio: 0.8
  max_distance: 0.7
  cross_check: true
  guided_matching: true
  max_num_matches: 32768

two_view_geometry:
  # Loosen slightly for aerial (default min_inliers=15, max_error=4)
  min_num_inliers: 15
  max_error: 6.0
  confidence: 0.999
  max_num_trials: 20000

sequential_matcher:
  # High overlap => many adjacent pairs
  overlap: 60

  # Loop detection => adds vocab-tree-based loop closure pairs
  loop_detection: true

  # Use COLMAPâ€™s built-in URL-spec (it will download/cache automatically)
  vocab_tree_path: "https://github.com/colmap/colmap/releases/download/3.11.1/vocab_tree_faiss_flickr100K_words256K.bin;vocab_tree_faiss_flickr100K_words256K.bin;96ca8ec8ea60b1f73465aaf2c401fd3b3ca75cdba2d3c50d6a2f6f760f275ddc"

  # Make loop detection more aggressive (more candidate pairs)
  loop_detection_period: 10
  loop_detection_num_images: 80
  loop_detection_num_nearest_neighbors: 3
  loop_detection_num_checks: 128

# If you set matching_method: vocab_tree_matcher
vocab_tree_matcher:
  vocab_tree_path: "https://github.com/colmap/colmap/releases/download/3.11.1/vocab_tree_faiss_flickr100K_words256K.bin;vocab_tree_faiss_flickr100K_words256K.bin;96ca8ec8ea60b1f73465aaf2c401fd3b3ca75cdba2d3c50d6a2f6f760f275ddc"
  num_images: 80

mapper:
  min_num_matches: 12
  init_min_num_inliers: 50

  ba_refine_focal_length: true
  ba_refine_principal_point: false
  ba_refine_extra_params: false

  multiple_models: true
  ba_global_function_tolerance: 1.0e-6
